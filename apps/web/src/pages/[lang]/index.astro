---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import LanguageSwitcher from '../../components/LanguageSwitcher.astro';
import HomeSection from '../../components/HomeSection.astro';
import ContentCard from '../../components/ContentCard.astro';

export async function getStaticPaths() {
  const pages = await getCollection('pages', ({ data }) => {
    // Only generate routes for home pages with published status
    return data.status === 'published' && data.type === 'home';
  });

  return pages.map(page => ({
    params: {
      lang: page.data.language,
    },
    props: { page },
  }));
}

const { page } = Astro.props;
const { Content } = await page.render();

// Get content for each category to display in sections
const allPages = await getCollection('pages', ({ data }) => {
  return data.status === 'published' && data.language === page.data.language;
});

const etendused = allPages.filter(p => p.data.category === 'etendused' && p.data.type === 'detail');
const workshopid = allPages.filter(p => p.data.category === 'workshopid' && p.data.type === 'detail');
const about = allPages.filter(p => p.data.category === 'about' && p.data.type === 'detail');
const gallery = allPages.filter(p => p.data.category === 'gallery' && p.data.type === 'detail');
const news = allPages.filter(p => p.data.category === 'news' && p.data.type === 'detail');

const isEstonian = page.data.language === 'et';
---

<BaseLayout
  title={page.data.title}
  description={page.data.description}
  language={page.data.language}
>
  <LanguageSwitcher
    slot="language-switcher"
    currentLang={page.data.language}
    currentSlug="index"
    translations={page.data.translated}
  />

  <!-- Hero Section -->
  <section id="hero" class="min-h-screen flex items-center justify-center bg-gradient-to-b from-slate-50 to-white">
    <div class="max-w-4xl mx-auto px-4 py-16 text-center">
      <h1 class="text-5xl md:text-7xl font-bold text-slate-900 mb-6">
        {page.data.title}
      </h1>
      <p class="text-xl md:text-2xl text-slate-600 mb-8">
        {page.data.description}
      </p>
      <div class="prose prose-lg prose-slate mx-auto">
        <Content />
      </div>
    </div>
  </section>

  <!-- Etendused Section -->
  <HomeSection
    id="etendused"
    title={isEstonian ? 'Etendused' : 'Performances'}
    description={isEstonian ? 'Meie etendused suurtele ja noorele publikule' : 'Our performances for adults and young audiences'}
    background="white"
  >
    <!-- Suurtele subsection -->
    <div id="suurtele" class="mb-16">
      <h3 class="text-2xl font-semibold text-slate-800 mb-6">
        {isEstonian ? 'Suurtele' : 'For Adults'}
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {etendused.filter(p => p.data.subcategory === 'suurtele').map(item => (
          <ContentCard
            title={item.data.title}
            description={item.data.description}
            href={`/${page.data.language}/${item.data.category}/${item.id.replace(/^(en|et)\//, '').replace(/\.md$/, '')}`}
            subcategory={isEstonian ? 'Suurtele' : 'For Adults'}
          />
        ))}
      </div>
    </div>

    <!-- Noorele publikule subsection -->
    <div id="noorele-publikule" class="mb-16">
      <h3 class="text-2xl font-semibold text-slate-800 mb-6">
        {isEstonian ? 'Noorele publikule' : 'For Young Audiences'}
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {etendused.filter(p => p.data.subcategory === 'noorele-publikule').map(item => (
          <ContentCard
            title={item.data.title}
            description={item.data.description}
            href={`/${page.data.language}/${item.data.category}/${item.id.replace(/^(en|et)\//, '').replace(/\.md$/, '')}`}
            subcategory={isEstonian ? 'Noorele publikule' : 'For Young Audiences'}
          />
        ))}
      </div>
    </div>
  </HomeSection>

  <!-- Workshopid Section -->
  <HomeSection
    id="workshopid"
    title={isEstonian ? 'Workshopid' : 'Workshops'}
    description={isEstonian ? 'Liikumise ja loomingulisuse töötoad' : 'Movement and creativity workshops'}
    background="slate"
  >
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {workshopid.map(item => (
        <ContentCard
          title={item.data.title}
          description={item.data.description}
          href={`/${page.data.language}/${item.data.category}/${item.id.replace(/^(en|et)\//, '').replace(/\.md$/, '')}`}
          category={isEstonian ? 'Workshop' : 'Workshop'}
        />
      ))}
    </div>
  </HomeSection>

  <!-- About Section -->
  <HomeSection
    id="about"
    title={isEstonian ? 'Meist' : 'About Us'}
    description={isEstonian ? 'Tutvuge meie meeskonna ja tegemistega' : 'Meet our team and learn about our work'}
    background="white"
  >
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {about.map(item => (
        <ContentCard
          title={item.data.title}
          description={item.data.description}
          href={`/${page.data.language}/${item.data.category}/${item.id.replace(/^(en|et)\//, '').replace(/\.md$/, '')}`}
        />
      ))}
    </div>
  </HomeSection>

  <!-- Gallery Section -->
  <HomeSection
    id="gallery"
    title={isEstonian ? 'Galerii' : 'Gallery'}
    description={isEstonian ? 'Pilte meie etendustest ja tööprotsessist' : 'Photos from our performances and creative process'}
    background="slate"
  >
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {gallery.map(item => (
        <ContentCard
          title={item.data.title}
          description={item.data.description}
          href={`/${page.data.language}/${item.data.category}/${item.id.replace(/^(en|et)\//, '').replace(/\.md$/, '')}`}
        />
      ))}
    </div>
  </HomeSection>

  <!-- Contact Section -->
  <section id="contact" class="min-h-screen py-24 bg-white">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <h2 class="text-4xl md:text-5xl font-bold text-slate-900 mb-4">
        {isEstonian ? 'Kontakt' : 'Contact'}
      </h2>
      <p class="text-xl text-slate-600 mb-12">
        {isEstonian ? 'Võta meiega ühendust' : 'Get in touch with us'}
      </p>
      <div class="prose prose-lg prose-slate mx-auto">
        <p class="text-lg">info@zuga.ee</p>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  html {
    scroll-behavior: smooth;
  }
</style>
